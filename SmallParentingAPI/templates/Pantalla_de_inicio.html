{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Página de Inicio</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static 'CSS/inicio.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="{% static 'CSS/boostrap.min.css' %}">
    <script>
        // Función para habilitar o deshabilitar el campo de texto según la opción seleccionada
        function habilitarCampoTexto(elemento) {
            var textField = document.getElementById(elemento.id + "-text");
            textField.disabled = (elemento.value !== "Otro" && elemento.value !== "Sí");
        }
    </script>
</head>
<body>
    <div class="contenedor">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container-fluid">
                <a class="navbar-brand" href="{% url 'inicio' %}">Inicio</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav ">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="true">Temas</a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="#" id="link-dificultades">Dificultades de aprendizaje</a>
                                <a class="dropdown-item" href="#" id="link-presion">Presión académica</a>
                                <a class="dropdown-item" href="#" id="link-salud">Salud mental estudiantil</a>
                                <a class="dropdown-item" href="#" id="link-comunicacion">Falta de comunicación</a>
                                <a class="dropdown-item" href="#" id="link-conducta">Problemas de conducta</a>
                                <a class="dropdown-item" href="#" id="link-gestion">Gestión del tiempo</a>
                                <a class="dropdown-item" href="#" id="link-conversacion">Conversación personalizada</a>
                            </div>                            
                        </li>
                    </ul>
                    <ul class="navbar-nav ms-md-auto">
                        {% if request.user.is_authenticated %}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'agregar_hijo' %}">Agregar Hijo</a>
                        </li>
                        {% endif %}
                
                        {% if not request.user.is_authenticated %}
                        <li class="nav-item">
                            <a class="nav-link" href="/registro/">Registrarse</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="mostrarPopup()">Iniciar sesión</a>
                        </li>
                        {% else %}
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="offcanvas" href="#PerfilHijo" role="button" aria-controls="PerfilesHijos">Perfiles</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'historial_respuestas' %}">Historial</a>
                        </li>
                        <li class="nav-item">
                            <span class="nav-link">{{ request.user.username }}</span>
                        </li>
                        <li class="nav-item">
                            <form action="{% url 'cerrar_sesion' %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-secondary">Cerrar Sesión</button>
                            </form>
                        </li>
                        {% endif %}
                    </ul>
                    <div id="popup" class="popup">
                        <div class="popup-content">
                            <span class="cerrar" onclick="cerrarPopup()">&times;</span>
                            
                            {% if error_message %}
                                <p class="error-message">{{ error_message }}</p>
                            {% endif %}
                            <h1>Inicio de sesion</h1>
                            <form action="" method="post">
                                {% csrf_token %}
                                <div class="form-group">
                                    <label id= "user_name"for="username" class="form-label mt-4">Nombre de usuario:</label>
                                    <input type="text" class="form-control" id="username" name="username" placeholder="Enter username">
                                </div>
                                <div class="form-group">
                                    <label id="password_style" for="password" class="form-label mt-4">Contraseña:</label>
                                    <input type="password" class="form-control" id="password" placeholder="Contraseña" autocomplete="off" name="password">
                                </div>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-lg btn-primary" type="submit">Iniciar sesión</button>
                                </div>
                                <a href="/registro/">Registrarse</a>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </nav>          
        <div class="container">
            <h1></h1>
            <div class="options">
                <div class="option" onclick="showModal('DIFICULTADES DE APRENDIZAJE', 'La educación es un proceso vital en la vida de cualquier individuo, pero para algunos, el camino hacia el aprendizaje puede ser un desafío debido a dificultades de aprendizaje. Las dificultades de aprendizaje son una variedad de trastornos que pueden afectar la capacidad de un estudiante para comprender, procesar o retener información. Estos desafíos pueden manifestarse de diferentes maneras, incluyendo dificultades con la lectura, la escritura, la matemática, la atención y el comportamiento. ', event)">
                    <h2>DIFICULTADES DE APRENDIZAJE</h2>
                </div>
                <div class="option" onclick="showModal('PRESIÓN ACADÉMICA', 'La presión académica es un problema cada vez más común entre estudiantes de todas las edades, desde primaria hasta la universidad. Muchos estudiantes sienten la necesidad de cumplir con altas expectativas académicas, lo que puede llevar a niveles de estrés y ansiedad insostenibles.', event)">
                    <h2>PRESIÓN ACADÉMICA</h2>
                </div>
                <div class="option" onclick="showModal('SALUD MENTAL ESTUDIANTIL', 'La salud mental estudiantil es un tema crítico y a menudo subestimado en la educación. Muchos estudiantes enfrentan diversos desafíos que afectan su bienestar emocional y psicológico, incluyendo el estrés, la ansiedad, la depresión y la soledad. Estas dificultades pueden interferir en su capacidad para concentrarse en sus estudios, tener relaciones saludables y alcanzar su potencial académico. ', event)">
                    <h2>SALUD MENTAL ESTUDIANTIL</h2>
                </div>
                <div class="option" onclick="showModal('FALTA DE COMUNICACIÓN', 'La falta de comunicación puede ser un obstáculo en cualquier relación, pero es especialmente difícil cuando se trata de la relación entre padres e hijos. La falta de comunicación puede resultar en malentendidos, conflictos y una sensación de desconexión. En el contexto escolar, la falta de comunicación puede llevar a problemas académicos y emocionales para los estudiantes.', event)">
                    <h2>FALTA DE COMUNICACIÓN</h2>
                </div>
                <div class="option" onclick="showModal('PROBLEMAS DE CONDUCTA', 'En el ámbito educativo, es común encontrar estudiantes que enfrentan desafíos relacionados con problemas de conducta. Estos problemas pueden manifestarse de diversas formas, como dificultades para seguir las normas, falta de respeto hacia los demás, actitudes disruptivas en el aula o dificultades para controlar sus emociones.', event)">
                    <h2>PROBLEMAS DE CONDUCTA</h2>
                </div>
                <div class="option" onclick="showModal('GESTIÓN DEL TIEMPO', 'La gestión del tiempo es un desafío común para muchos estudiantes, especialmente cuando tienen que equilibrar el estudio con otras responsabilidades y actividades. Una mala gestión del tiempo puede impactar negativamente la relación con sus hijos. Causando falta de tiempo de calidad, estrés, falta de atención, desorganización y pérdida de oportunidades. Es fundamental que los padres se esfuercen por equilibrar sus responsabilidades y dedicar tiempo suficiente a sus hijos para fomentar un ambiente familiar saludable y una crianza positiva.', event)">
                    <h2>GESTIÓN DEL TIEMPO</h2>
                </div>
                <div class="option" onclick="showModal('CONVERSACIÓN PERSONALIZADA', 'Una conversación personalizada es una exelente opcion porque ofrece respuestas específicas y relevantes a las necesidades individuales de cada usuario. Esto aumenta el compromiso y la satisfacción del usuario, mejora la comprensión del usuario y crea una experiencia más valiosa y confiable. Además, resuelve problemas específicos de manera eficiente y fomenta una relación más positiva entre el usuario y el sistema o plataforma. En general, la personalización mejora la experiencia del usuario y fortalece la conexión con el servicio o producto ofrecido.', event)">
                    <h2>CONVERSACIÓN PERSONALIZADA</h2>
                </div>
            </div>
        </div>

        <dialog id="modal">
            <button id="btn-cerrar-modal" onclick="closeModal()">Cerrar</button>
            <h2 id="modal-titulo"></h2>
            <p id="modal-definicion"></p>
            <a id="btn-abrir-chat" href="#">Ir</a>
        </dialog>

        <div class="offcanvas offcanvas-start" tabindex="-1" id="PerfilHijo" aria-labelledby="PerfilesHijos">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="PerfilesHijos">Perfiles de Hijos</h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <ul class="list-group">
                    {% for hijo in hijos %}
                    <li class="list-group-item">{{ hijo.nombre }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>        
    </div>
    <script>
        function showModal(titulo, definicion, event) {
            event.preventDefault(); // Evita que se siga el enlace de la opción seleccionada

            {% if not request.user.is_authenticated %} 
            mostrarPopup();
            return;
            {% endif %}
            const modal = document.getElementById("modal");
            const modalTitulo = document.getElementById("modal-titulo");
            const modalDefinicion = document.getElementById("modal-definicion");
            const btnAbrirChat = document.getElementById("btn-abrir-chat");

            modalTitulo.textContent = titulo;
            modalDefinicion.textContent = definicion;

            // Actualiza el href dinámicamente según la opción seleccionada
            if (titulo === "DIFICULTADES DE APRENDIZAJE") {
                btnAbrirChat.href = "{% url 'dificultadesAprendizaje' %}";
            } else if(titulo === "PRESIÓN ACADÉMICA"){
                btnAbrirChat.href = "{% url 'PresionAcademica' %}";
            } else if(titulo === "SALUD MENTAL ESTUDIANTIL"){
                btnAbrirChat.href = "{% url 'SaludMentalEstudiantil' %}";
            }else if(titulo === "FALTA DE COMUNICACIÓN"){
                btnAbrirChat.href = "{% url 'FaltaComunicacion' %}";
            }else if(titulo === "PROBLEMAS DE CONDUCTA"){
                btnAbrirChat.href = "{% url 'ProblemasConducta' %}"; 
            }else if(titulo === "GESTIÓN DEL TIEMPO"){
                btnAbrirChat.href = "{% url 'GestiondelTiempo' %}"; 
            }else if(titulo === "CONVERSACIÓN PERSONALIZADA"){
                btnAbrirChat.href = "{% url 'ConversacionPersonalizada' %}"; 
            }else{
                btnAbrirChat.href = `/chat/?opcion=${encodeURIComponent(titulo)}&definicion=${encodeURIComponent(definicion)}`;
            }
            modal.showModal();
        }

        function closeModal() {
            const modal = document.getElementById("modal");
            modal.close();
        }
        function mostrarPopup() {
            document.getElementById("popup").style.display = "block";
        }

        function cerrarPopup() {
            document.getElementById("popup").style.display = "none";
        }

        // Obtén una referencia al botón "Temas" por su clase o ID, dependiendo de cómo esté definido en tu HTML
        var botonTemas = document.querySelector('.nav-link.dropdown-toggle');

        // Obtén una referencia al menú desplegable por su clase o ID, nuevamente, según cómo esté definido en tu HTML
        var menuDesplegable = document.querySelector('.dropdown-menu');

        // Agrega un evento click al botón "Temas"
        botonTemas.addEventListener('click', function (event) {
            // Evita que el evento de clic se propague hacia arriba y cierre el menú inmediatamente
            event.stopPropagation();

            // Verifica si el menú está actualmente visible
            var estaVisible = menuDesplegable.style.display === 'block';

            // Si el menú está visible, ocúltalo; de lo contrario, muéstralo
            if (estaVisible) {
                menuDesplegable.style.display = 'none';
            } else {
                menuDesplegable.style.display = 'block';
            }
        });

        // Agrega un evento click al menú desplegable
        menuDesplegable.addEventListener('click', function (event) {
            // Verifica si el elemento clicado es un enlace en el menú desplegable
            if (event.target.tagName === 'A') {
                // Cierra el menú desplegable
                menuDesplegable.style.display = 'none';
                // Verifica si el usuario ha iniciado sesión
                {% if request.user.is_authenticated %} 
                    // Obtiene el texto del enlace clicado
                    var linkText = event.target.textContent;

                    // Realiza una redirección basada en el texto del enlace
                    switch (linkText) {
                        case 'Dificultades de aprendizaje':
                            window.location.href = "{% url 'dificultadesAprendizaje' %}";
                            break;
                        case 'Presión académica':
                            window.location.href = "{% url 'PresionAcademica' %}";
                            break;
                        case 'Salud mental estudiantil':
                            window.location.href = "{% url 'SaludMentalEstudiantil' %}";
                            break;
                        case 'Falta de comunicación':
                            window.location.href = "{% url 'FaltaComunicacion' %}";
                            break;
                        case 'Problemas de conducta':
                            window.location.href = "{% url 'ProblemasConducta' %}";
                            break;
                        case 'Gestión del tiempo':
                            window.location.href = "{% url 'GestiondelTiempo' %}";
                            break;
                        case 'Conversación personalizada':
                            window.location.href = "{% url 'ConversacionPersonalizada' %}";
                            break;
                        default:
                            // Puedes manejar otros enlaces aquí o redireccionar a una página predeterminada
                            break;
                    }
                {% else %}
                    // Si el usuario no ha iniciado sesión, muestra la ventana emergente
                    mostrarPopup();
                {% endif %}
            }
        });

        // Agrega un evento click al documento para cerrar el menú cuando se hace clic en cualquier parte de la ventana
        document.addEventListener('click', function (event) {
            // Verifica si el menú está actualmente visible y si el clic ocurrió fuera del menú
            if (menuDesplegable.style.display === 'block' && !menuDesplegable.contains(event.target)) {
                menuDesplegable.style.display = 'none';
            }
        });
        
        // Espera a que el documento esté completamente cargado
        document.addEventListener('DOMContentLoaded', function () {
            // Encuentra el enlace de "Perfiles"
            var perfilesLink = document.querySelector('a[href="#offcanvasPerfiles"]');

            // Encuentra el offcanvas por su ID
            var offcanvas = new bootstrap.Offcanvas(document.getElementById('offcanvasPerfiles'));

            // Agrega un evento de clic al enlace de "Perfiles" para abrir el offcanvas
            perfilesLink.addEventListener('click', function (event) {
                event.preventDefault(); // Evita que el enlace funcione como una URL
                offcanvas.toggle(); // Abre o cierra el offcanvas según su estado actual
            });
        });
    </script>
</body>
</html>